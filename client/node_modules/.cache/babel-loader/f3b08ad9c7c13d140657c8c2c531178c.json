{"ast":null,"code":"var _jsxFileName = \"/Users/pc/KolomoyetsProjects/Study/project-zigzag/project-zigzag/client/src/views/game/index.tsx\",\n    _s = $RefreshSig$();\n\nimport { useEffect } from \"react\";\nimport StatsService from \"../../api/services/stats\";\nimport Row from \"../../components/row\";\nimport AppContext from \"../../store/context/app\";\nimport GameContext from \"../../store/context/game\";\nimport StatsContext from \"../../store/context/stats\";\nimport SummaryContext from \"../../store/context/summary\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const checkRow = (content, row, column, field, lastTry) => {\n  let isAllowedToGo = true;\n\n  if (lastTry.row != undefined && lastTry.column != undefined) {\n    const deltaX = Math.abs(column - lastTry.column);\n    const deltaY = Math.abs(row - lastTry.row);\n    isAllowedToGo = Number(content) === 0 && (deltaX === 2 && deltaY === 1 || deltaX === 1 && deltaY === 2);\n  }\n\n  return isAllowedToGo;\n};\n\nconst getTotalAvaliableMoves = (field, row, column) => {\n  const avaliableMoves = [[2, 1], [2, -1], [-2, 1], [-2, -1], [1, 2], [-1, 2], [1, -2], [-1, -2]];\n  let totalMoves = 0;\n  avaliableMoves.forEach(_ref => {\n    let [moveRows, moveColumns] = _ref;\n    const newRow = row + moveRows;\n    const newColumn = column + moveColumns;\n\n    if (newRow >= 0 && newRow < field.length && newColumn >= 0 && newColumn < field[0].length) {\n      if (field[newRow][newColumn] === '0') totalMoves++;\n    }\n  });\n  return totalMoves;\n};\n\nconst checkWin = field => {\n  const isWin = field.reduce((acc, curr) => [...acc, curr.some(el => el === '0')], []).every(el => !el);\n  return isWin;\n};\n\nconst Game = _ref2 => {\n  _s();\n\n  let {\n    onFinish\n  } = _ref2;\n  const {\n    data: {\n      fieldSize,\n      field,\n      time\n    },\n    setData: setGameData\n  } = GameContext.useContext();\n  const {\n    data: {\n      user: {\n        _id: id\n      }\n    }\n  } = AppContext.useContext();\n  const {\n    setData: setStatsData\n  } = StatsContext.useContext();\n  const {\n    setData: setSummaryData\n  } = SummaryContext.useContext(); // const defaultField = useMemo(() => Array(fieldSize.width).fill('0').map(() => Array(fieldSize.height).fill('0')), [field, fieldSize]);\n\n  const onCellClick = async (row, column, field, lastTry) => {\n    const fieldCopy = field.slice();\n    const nextNumber = lastTry !== null && lastTry !== void 0 && lastTry.number ? Number(fieldCopy[lastTry.row][lastTry.column]) + 1 : 1;\n    fieldCopy[row][column] = nextNumber.toString();\n    setGameData({\n      field: fieldCopy,\n      lastTry: {\n        row,\n        column,\n        number: nextNumber,\n        moves: lastTry.moves + 1\n      }\n    });\n    const availableMoves = getTotalAvaliableMoves(fieldCopy, row, column);\n\n    if (availableMoves === 0) {\n      await setSummaryData({\n        isShow: true,\n        isSuccess: true,\n        title: 'Game Over',\n        subtitle: checkWin(field) ? 'YOU WIN!' : 'YOU LOSE!'\n      });\n      onFinish();\n      setGameData({\n        lastTry: {\n          row: null,\n          column: null,\n          number: 0,\n          moves: 0\n        }\n      }); // === TODO:\n      // === PUSH results of lastGame on the server\n\n      StatsService.update(id, {\n        moves: lastTry.moves + 1,\n        bestGame: {\n          time,\n          field: {\n            width: field[0].length,\n            height: field.length\n          }\n        }\n      }).then(res => {\n        const {\n          data\n        } = res;\n        console.log(data);\n        setStatsData(data);\n      });\n    }\n  };\n\n  useEffect(() => {\n    const field = Array(fieldSize.width).fill('0').map(() => Array(fieldSize.height).fill('0'));\n    setGameData({\n      field,\n      onCellClick,\n      lastTry: {\n        row: null,\n        column: null,\n        number: 0,\n        moves: 0\n      }\n    }); // eslint-disable-next-line react-hooks/exhaustive-deps\n\n    setGameData({\n      onCellClick\n    });\n  }, [fieldSize]);\n  const rows = field.map((row, index) => /*#__PURE__*/_jsxDEV(Row, {\n    content: row,\n    number: index\n  }, `row${index}`, false, {\n    fileName: _jsxFileName,\n    lineNumber: 158,\n    columnNumber: 5\n  }, this));\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    children: rows\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 161,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Game, \"zsNOiBrv/XPXOs56zuNSnvKcIIc=\");\n\n_c = Game;\nexport default Game;\n\nvar _c;\n\n$RefreshReg$(_c, \"Game\");","map":{"version":3,"sources":["/Users/pc/KolomoyetsProjects/Study/project-zigzag/project-zigzag/client/src/views/game/index.tsx"],"names":["useEffect","StatsService","Row","AppContext","GameContext","StatsContext","SummaryContext","checkRow","content","row","column","field","lastTry","isAllowedToGo","undefined","deltaX","Math","abs","deltaY","Number","getTotalAvaliableMoves","avaliableMoves","totalMoves","forEach","moveRows","moveColumns","newRow","newColumn","length","checkWin","isWin","reduce","acc","curr","some","el","every","Game","onFinish","data","fieldSize","time","setData","setGameData","useContext","user","_id","id","setStatsData","setSummaryData","onCellClick","fieldCopy","slice","nextNumber","number","toString","moves","availableMoves","isShow","isSuccess","title","subtitle","update","bestGame","width","height","then","res","console","log","Array","fill","map","rows","index"],"mappings":"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","sourcesContent":["import { useCallback, useEffect, FC, useMemo } from \"react\";\nimport StatsService from \"../../api/services/stats\";\n\nimport Row from \"../../components/row\";\nimport AppContext from \"../../store/context/app\";\n\nimport GameContext from \"../../store/context/game\";\nimport StatsContext from \"../../store/context/stats\";\nimport SummaryContext from \"../../store/context/summary\";\nimport { Try } from \"../../utils\";\n\nexport const checkRow = (content: string, row: number, column: number, field: string[][], lastTry: Try): boolean => {\n  let isAllowedToGo = true;\n\n  if (lastTry.row != undefined && lastTry.column != undefined) {\n    const deltaX = Math.abs(column - lastTry.column);\n    const deltaY = Math.abs(row - lastTry.row);\n\n    isAllowedToGo = Number(content) === 0 && (\n      ((deltaX === 2) && (deltaY === 1)) ||\n      ((deltaX === 1) && (deltaY === 2)));\n  }\n\n  return isAllowedToGo;\n}\n\nconst getTotalAvaliableMoves = (field: string[][], row: number, column: number): number => {\n  const avaliableMoves = [\n    [2, 1],\n    [2, -1],\n    [-2, 1],\n    [-2, -1],\n\n    [1, 2],\n    [-1, 2],\n    [1, -2],\n    [-1, -2],\n  ];\n\n  let totalMoves = 0;\n\n  avaliableMoves.forEach(([moveRows, moveColumns]) => {\n    const newRow = row! + moveRows;\n    const newColumn = column! + moveColumns;\n\n    if (\n      (newRow >= 0 && newRow < field.length) &&\n      (newColumn >= 0 && newColumn < field[0].length)\n    ) {\n      if (field[newRow][newColumn] === '0') totalMoves++;\n    }\n  });\n\n  return totalMoves;\n}\n\nconst checkWin = (field: string[][]): boolean => {\n  const isWin = field\n    .reduce((acc, curr) => [...acc, curr.some(el => el === '0')], [] as boolean[])\n    .every(el => !el);\n\n  return isWin;\n}\n\ntype GameProps = {\n  onFinish: () => void\n}\nconst Game: FC<GameProps> = ({ onFinish }) => {\n  const { data: {\n    fieldSize,\n    field,\n    time\n  }, setData: setGameData } = GameContext.useContext();\n  const { data: { user: { _id: id } } } = AppContext.useContext();\n  const { setData: setStatsData } = StatsContext.useContext();\n  const { setData: setSummaryData } = SummaryContext.useContext();\n\n  // const defaultField = useMemo(() => Array(fieldSize.width).fill('0').map(() => Array(fieldSize.height).fill('0')), [field, fieldSize]);\n\n  const onCellClick = async (row: number, column: number, field: string[][], lastTry: Try) => {\n    const fieldCopy = field.slice();\n\n    const nextNumber = (lastTry?.number) ?\n      Number(fieldCopy[lastTry.row!][lastTry.column!]) + 1 :\n      1;\n\n    fieldCopy[row][column] = nextNumber.toString();\n\n    setGameData({\n      field: fieldCopy,\n      lastTry: {\n        row,\n        column,\n        number: nextNumber,\n        moves: lastTry.moves + 1\n      }\n    });\n\n    const availableMoves = getTotalAvaliableMoves(fieldCopy, row, column);\n\n    if (availableMoves === 0) {\n      await setSummaryData(({\n        isShow: true,\n        isSuccess: true,\n        title: 'Game Over',\n        subtitle: checkWin(field) ? 'YOU WIN!' : 'YOU LOSE!'\n      }));\n\n      onFinish();\n\n      setGameData({\n        lastTry: {\n          row: null,\n          column: null,\n          number: 0,\n          moves: 0,\n        },\n      });\n\n      // === TODO:\n      // === PUSH results of lastGame on the server\n      StatsService.update(id!, {\n        moves: lastTry.moves + 1,\n        bestGame: {\n          time,\n          field: {\n            width: field[0].length,\n            height: field.length\n          }\n        }\n      })\n        .then(res => {\n          const { data } = res;\n          console.log(data);\n          setStatsData(data);\n        });\n    }\n  };\n\n  useEffect(() => {\n    const field = Array(fieldSize.width).fill('0').map(() => Array(fieldSize.height).fill('0'));\n\n    setGameData({\n      field,\n      onCellClick,\n      lastTry: {\n        row: null,\n        column: null,\n        number: 0,\n        moves: 0,\n      }\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    setGameData({ onCellClick });\n  }, [fieldSize]);\n\n  const rows = field.map((row, index) => (\n    <Row key={`row${index}`} content={row} number={index} />));\n\n  return (\n    <section>\n      {rows}\n    </section>\n  )\n};\n\nexport default Game;"]},"metadata":{},"sourceType":"module"}